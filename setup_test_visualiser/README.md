# Сборка исполняемого файла

Эта папка содержит только инфраструктуру сборки (`build_exe.ps1`, `launch_app.py`, документацию и артефакты PyInstaller). Все рабочие файлы (`app.py`, `src/`, данные) подтягиваются напрямую из корня проекта, поэтому копировать их сюда не нужно.

## Что помещается в exe
- код Streamlit (`app.py` и весь `src/`);
- служебные данные из `help_data/` (используются как шаблон при первом запуске);
- запускающий скрипт `launch_app.py`, который:
  - разворачивает рабочую директорию в `%LOCALAPPDATA%\test_visualiser` (сюда кладутся состояния, OHCL, выгрузки и т.п.);
  - при необходимости добавляет в неё отсутствующие файлы из `help_data`;
  - запускает `streamlit run` над оригинальным `app.py` из архива и автоматически открывает браузер.

Подробный состав см. в `runtime_manifest.md`.

## Требования
1. Python 3.10+ (из твоего `.venv`).
2. В корне проекта выполнено `pip install -r requirements.txt`.
3. Для сборки поставлены инструменты: `pip install pyinstaller pyinstaller-hooks-contrib`.

> Из виртуального окружения PowerShell выходи командой `deactivate`.

## Команда сборки
```powershell
cd setup_test_visualiser
.\build_exe.ps1 -Clean -PythonExe ..\.venv\Scripts\python.exe
```

Скрипт по умолчанию использует `launch_app.py` как точку входа, добавляет в архив `app.py`, `src/`, `help_data/` и коллекционирует ресурсы `streamlit`. Готовый файл лежит в `setup_test_visualiser\dist\test_visualiser.exe`.

## Рабочий цикл
1. Меняешь код в корневом проекте.
2. (При необходимости) активируешь `.venv` и обновляешь зависимости.
3. Запускаешь `.\build_exe.ps1 -Clean -PythonExe ..\.venv\Scripts\python.exe`.
4. Распространяешь свежий `dist\test_visualiser.exe`.

### Где искать пользовательские данные
- После запуска exe рабочая папка создаётся в `%LOCALAPPDATA%\test_visualiser`.
- Файл состояния (`help_data\dashboard_state.json`), выгрузки CSV и кэш OHCL лежат там же, поэтому при обновлении exe данные сохраняются.
- Чтобы сбросить состояние, можно удалить соответствующие файлы из этой папки (exe при следующем старте подставит шаблон из дистрибутива).

Если понадобятся дополнительные ресурсы/модули, добавь их в `build_exe.ps1` (например, ещё один `--add-data` или `--collect-all`).
